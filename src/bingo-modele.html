<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="bingo-modele">
  <script>
    class BingoModele extends Polymer.Element {
      static get is() { return 'bingo-modele' }
      static get properties() {
        return {
          cases: {
            type: Array,
            value: function () {
              return this.createCases()
            }
          },
          lignes: {
            value: [1, 2, 3, 4, 5]
          },
          colonnes: {
            value: ['b', 'i', 'n', 'g', 'o']
          }
        }
      }

      connectedCallback() {
        super.connectedCallback()
      }

      _getCase(ligne, colonne, cases) {
        // if (this.cases) {
          let index = ligne * 5 + colonne;
          return this.cases[index]
        // }
      }

      reset() {
        this.afficheBingo(false)
        this.shadowRoot.querySelector('form').reset()
        this.set('cases', this.createCases())
        //car-anim
      }

      afficheBingo(affiche) {
        const bingo = this.shadowRoot.querySelector('#bingo')
        if (affiche) {
          bingo.classList.add('visible')
        } else {
          bingo.classList.remove('visible')
        }
      }

      fermerBingo() {
        this.afficheBingo(false)
      }

      goto(route) {
        history.pushState({}, '', route)
        window.dispatchEvent(new CustomEvent('location-changed', {
          detail: {
            route: route
          }
        }))
      }

      accueil() {
        history.back();

//         const animKeyframes = [
//           { transform: 'translateX(0%)' },
//           { Â transform: 'translateX(150%)' }
//           // { opacity: 1 },
//           // { opacity: 0 }
//           // { 'margin-left': -200 },
//           // { 'margin-left': 0 }
//         ]
//         const animationTiming = {
//           duration: 70000, //milliseconds
//           easing: 'ease-in-out', //'linear', a bezier curve, etc.
//           delay: 10, //milliseconds
//           iterations: 1, // Infinity or a number
//           direction: 'alternate', //'normal', 'reverse', etc.
//           fill: 'forwards' //'backwards', 'both', 'none', 'auto'
//         }
//         this.shadowRoot.querySelectorAll('.car-anim').forEach((car) => {
//           car.animate(animKeyframes, animationTiming)
//         })

//         function whichTransitionEvent(){
//     var t;
//     var el = document.createElement('fakeelement');
//     var transitions = {
//       'transition':'transitionend',
//       'OTransition':'oTransitionEnd',
//       'MozTransition':'transitionend',
//       'WebkitTransition':'webkitTransitionEnd'
//     }

//     for(t in transitions){
//         if( el.style[t] !== undefined ){
//             return transitions[t];
//         }
//     }
// }
// /* Listen for a transition! */
// var transitionEvent = whichTransitionEvent();
// transitionEvent && e.addEventListener(transitionEvent, function() {
// 	console.log('Transition complete!  This is the callback, no library needed!');
// });

        // var animations = document.getAnimations ? document.getAnimations() : document.timeline.getAnimations();
        // animations[0].onfinish = function () {
          // this.goto('menu')
        // };

        // 
      }

      createCases() {
        let cases = this.getTypes()

        cases.sort((caseX, caseY) => {
          return caseX.random - caseY.random;
        })

        return cases
      }

      pop() {
        this.dispatchEvent(new CustomEvent('bingo-pop', {bubbles: true, composed: true}))

        this.verifierBingo()
      }

      verifierBingo() {
        this.verificationDesLignes()
        this.verificationDesColonnes()
        this.verificationDesDiagonales()
        this.verifierSuperBingo()
      }

      verifierSuperBingo() {
        const nbX = this.shadowRoot.querySelectorAll('.grid-box input[type=checkbox]:checked').lenght
        if (nbX === 25) {
          this.afficheBingo(true)
        }
      }

      verificationDesLignes() {
        const lignes = [0,1,2,3,4]
        const colonnes = [0,1,2,3,4]
        lignes.forEach((indexLigne) => {
          let nbX = 0
          colonnes.forEach((indexColonne) => {
            if (this.getValeurCase(indexLigne, indexColonne)) {
              nbX++
            }
          })
          if (nbX === 5) {
            this.afficheBingo(true)
          }
        })
      }

      verificationDesColonnes() {
        const colonnes = [0,1,2,3,4]
        const lignes = [0,1,2,3,4]
        colonnes.forEach((indexColonne) => {
          let nbX = 0
          lignes.forEach((indexLigne) => {
            if (this.getValeurCase(indexLigne, indexColonne)) {
              nbX++
            }
          })
          if (nbX === 5) {
            this.afficheBingo(true)
          }
        })
      }

      verificationDesDiagonales() {
        if (this.getValeurCase(0, 0) 
        && this.getValeurCase(1, 1) 
        && this.getValeurCase(2, 2) 
        && this.getValeurCase(3, 3) 
        && this.getValeurCase(4, 4)) {
          this.afficheBingo(true)
        } 
        if (this.getValeurCase(0, 4) 
        && this.getValeurCase(1, 3) 
        && this.getValeurCase(2, 2) 
        && this.getValeurCase(3, 1) 
        && this.getValeurCase(4, 0)) {
          this.afficheBingo(true)
        } 
      }

      getValeurCase(indexLigne, indexColonne) {
        return this.shadowRoot.querySelector(`#case-${indexLigne}-${indexColonne}`).checked;
      }

      getRandomInt(min, max) {
        min = Math.ceil(min)
        max = Math.floor(max)
        return Math.floor(Math.random() * (max - min)) + min //The maximum is exclusive and the minimum is inclusive
      }
      
      getTypes() {
        return []
      }
    }

    window.customElements.define(BingoModele.is, BingoModele)
  </script>
</dom-module>