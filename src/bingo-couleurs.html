<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<!-- <link rel="import" href="../bower_components/iron-icons/maps-icons.html"> -->
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="bingo-modele.html">
<link rel="import" href="bingo-styles.html">
<link rel="import" href="bingo-icons.html">
<!-- <link rel="import" href="bingo-state.html"> -->

<dom-module id="bingo-couleurs">
  <template>
    <style include="bingo-styles">
       :host {
        display: block;
        height: 100vh;
        overflow: hidden;
        box-sizing: border-box;
      }

      .car-anim {
        animation-name: car;
        animation-duration: 0.5s;
        /* animation-delay: 2.5s; */
        margin: 0 9%;
      }

      @keyframes car {
        from {
          /* margin-left: -200%; */
          transform: translate(-200%, 0);
        }
        to {
          /* margin-left: 0; */
          transform: translate(0, 0);
        }
      } 

      .car-anim2 {
        animation-name: car2;
        animation-duration: 0.5s;
        /* animation-delay: 2.5s; */
        margin: 0 9%;
      }

      @keyframes car2 {
        from {
          transform: translate(-200%, 0);
        }
        to {
          transform: translate(0, 0);
        }
      }
    </style>

    <audio id="vroum">
      <source src="../sounds/vroom2.mp3" type="audio/mpeg">
    </audio>

    <app-toolbar>
      <div main-title>Couleurs</div>
      <paper-icon-button on-tap="reset" icon="bingo-icons:refresh"></paper-icon-button>
      <paper-icon-button on-tap="accueil" icon="bingo-icons:home"></paper-icon-button>
    </app-toolbar>

    <div id="bingo" on-tap="fermerBingo"><div>Bingo!</div></div>

    <form>
      <div class="grid-box unselectable">

        <template is="dom-repeat" items="[[lignes]]" as="ligne" index-as="l">
          <div class="grid-row">
            <template is="dom-repeat" items="[[colonnes]]" as="colonne" index-as="c">
              <div class="grid-item">
                <input on-change="pop" id="case-[[l]]-[[c]]" type="checkbox">
                <label class="case iconSvg" for$="case-[[l]]-[[c]]">
                  <iron-icon icon="bingo-icons:clear" class="x2"></iron-icon>
                  <iron-icon icon="bingo-icons:clear" class="x"></iron-icon>
                  <iron-icon icon="bingo-icons2:voiture1" xicon="maps:directions-car" class="car car-anim" style="color: [[_getCouleur(l, c, cases)]]"></iron-icon>
                </label>
              </div>
            </template>
          </div>
        </template>

      </div>
    </form>

  </template>

  <script>
    class BingoCouleurs extends ReduxMixin(Polymer.GestureEventListeners(BingoModele)) {
      static get is() { return 'bingo-couleurs' }

      static get properties() {
        return {
          lignes: {
            value: []
          }
        }
      }

      _getCouleur(ligne, colonne, cases) {
        // if (cases) {
          return this._getCase(ligne, colonne, cases).couleur
        // }
      }

      connectedCallback() {
        super.connectedCallback();

        setTimeout(x => {
          this.set('lignes', [1, 2, 3, 4, 5]);
          this.$.vroum.play()
        }, 200)
      }

      reset() {
        this.$.vroum.play()

        let cars = this.shadowRoot.querySelectorAll('.car')
        let nouvClsAnim, ancienneClsAnim
        if (cars[0].classList.contains('car-anim')) {
          nouvClsAnim = 'car-anim2'
          ancienneClsAnim = 'car-anim'
        } else {
          nouvClsAnim = 'car-anim'
          ancienneClsAnim = 'car-anim2'
        }
        cars.forEach((car) => {
          car.classList.remove(ancienneClsAnim)
          car.classList.add(nouvClsAnim)
        })
        super.reset();
      }

      // createCases() {
      //   setTimeout(x => {
      //     super.createCases()
      //   }, 2000)
      // }

      getTypes() {
        let types = [
          {
            nom: 'rouge',
            couleur: '#ce1a1a',
            nombre: 4
          },
          {
            couleur: 'white',
            nombre: 4
          },
          {
            couleur: 'black',
            nombre: 4
          },
          {
            // blue
            couleur: '#3131f1',
            nombre: 4
          },
          {
            // gray
            couleur: '#676767',
            nombre: 4
          },
          // {
          //   couleur: 'yellow',
          //   nombre: 2
          // },
          {
            // green
            couleur: '#216f21',
            nombre: 3
          },
          // {
          //   // rose
          //   couleur: '#c3358f',
          //   nombre: 2
          // },
          // {
          //   // brun
          //   couleur: '#775656',
          //   nombre: 2
          // },
          {
            couleur: 'orange',
            nombre: 2
          }
        ]

        let liste = []

        types.forEach(function (type) {
          for (let index = 0; index < type.nombre; index++) {
            liste.push(Object.assign({ random: Math.random() }, type))
          }
        }, this)

        if (liste.length !== 25) {
          throw "Il n'y a pas 25 voitures! (" + liste.length + ")"
        }

        return liste
      }
    }

    window.customElements.define(BingoCouleurs.is, BingoCouleurs)
  </script>
</dom-module>